
    

    EXEC('create view "dbo"."hash__cmis_dbo_users__dbt_tmp" as 
-- Generated by AutomateDV (formerly known as dbtvault)

    

WITH source_data AS (

    SELECT

    ID,
    Email,
    Password,
    FirstName,
    LastName,
    EmployeeCode,
    Image,
    Thumb,
    DOB,
    Gender,
    Address,
    Phone,
    Active,
    Display,
    CreatedDate,
    CreatedByName,
    CreatedByID,
    TitleID,
    UserName,
    ContractDate,
    BeginWorkDate,
    LoyaltyYear,
    ModifiedDate,
    ModifiedByID,
    ModifiedByName,
    IsIntership,
    TitleText,
    WeightUser,
    EmployeeTypeID,
    About,
    Facebook,
    Twitter,
    GooglePlus,
    History,
    IsShowContact,
    KPIEmployeeTypeID,
    QuitDate,
    IsExternal,
    UserType,
    TokenKey,
    EndContractDate,
    HRCandidateID,
    AltEmail,
    AltPassword,
    AltUserName,
    SocialInsuranceNumber,
    Certificate,
    IdentityCardNumber,
    IdentityCardDate,
    IdentityCardPlace,
    CompanyID,
    LocationID,
    WorkTime,
    LevelText,
    Major,
    School,
    CurrentAdress,
    GroupTypeID,
    NextTokenKey,
    TokenExpiredDate,
    StatusSync,
    TimeSync,
    CountSync,
    CurrentURL,
    RoleID,
    GroupID,
    IsEmpNoMax,
    DV_RECORD_SOURCE,
    DV_APPLIED_DATE

    FROM "DWH"."dbo"."stg__cmis_dbo_users"
),

derived_columns AS (

    SELECT

    ID,
    Email,
    Password,
    FirstName,
    LastName,
    EmployeeCode,
    Image,
    Thumb,
    DOB,
    Gender,
    Address,
    Phone,
    Active,
    Display,
    CreatedDate,
    CreatedByName,
    CreatedByID,
    TitleID,
    UserName,
    ContractDate,
    BeginWorkDate,
    LoyaltyYear,
    ModifiedDate,
    ModifiedByID,
    ModifiedByName,
    IsIntership,
    TitleText,
    WeightUser,
    EmployeeTypeID,
    About,
    Facebook,
    Twitter,
    GooglePlus,
    History,
    IsShowContact,
    KPIEmployeeTypeID,
    QuitDate,
    IsExternal,
    UserType,
    TokenKey,
    EndContractDate,
    HRCandidateID,
    AltEmail,
    AltPassword,
    AltUserName,
    SocialInsuranceNumber,
    Certificate,
    IdentityCardNumber,
    IdentityCardDate,
    IdentityCardPlace,
    CompanyID,
    LocationID,
    WorkTime,
    LevelText,
    Major,
    School,
    CurrentAdress,
    GroupTypeID,
    NextTokenKey,
    TokenExpiredDate,
    StatusSync,
    TimeSync,
    CountSync,
    CurrentURL,
    RoleID,
    GroupID,
    IsEmpNoMax,
    DV_RECORD_SOURCE,
    DV_APPLIED_DATE,
    DV_RECORD_SOURCE AS dv_recordsource,
    cast( DV_APPLIED_DATE as DATETIME2(6)) AS dv_load_timestamp,
    cast(ID as VARCHAR(8000)) AS user_code,
    ''default'' AS dv_tenant_id,
    ''default'' AS dv_collisioncode

    FROM source_data
),

hashed_columns AS (

    SELECT

    ID,
    Email,
    Password,
    FirstName,
    LastName,
    EmployeeCode,
    Image,
    Thumb,
    DOB,
    Gender,
    Address,
    Phone,
    Active,
    Display,
    CreatedDate,
    CreatedByName,
    CreatedByID,
    TitleID,
    UserName,
    ContractDate,
    BeginWorkDate,
    LoyaltyYear,
    ModifiedDate,
    ModifiedByID,
    ModifiedByName,
    IsIntership,
    TitleText,
    WeightUser,
    EmployeeTypeID,
    About,
    Facebook,
    Twitter,
    GooglePlus,
    History,
    IsShowContact,
    KPIEmployeeTypeID,
    QuitDate,
    IsExternal,
    UserType,
    TokenKey,
    EndContractDate,
    HRCandidateID,
    AltEmail,
    AltPassword,
    AltUserName,
    SocialInsuranceNumber,
    Certificate,
    IdentityCardNumber,
    IdentityCardDate,
    IdentityCardPlace,
    CompanyID,
    LocationID,
    WorkTime,
    LevelText,
    Major,
    School,
    CurrentAdress,
    GroupTypeID,
    NextTokenKey,
    TokenExpiredDate,
    StatusSync,
    TimeSync,
    CountSync,
    CurrentURL,
    RoleID,
    GroupID,
    IsEmpNoMax,
    DV_RECORD_SOURCE,
    DV_APPLIED_DATE,
    dv_recordsource,
    dv_load_timestamp,
    user_code,
    dv_tenant_id,
    dv_collisioncode,

    CONVERT(CHAR(32), HASHBYTES(''MD5'', NULLIF(CONCAT(
        ISNULL(NULLIF(UPPER(TRIM(CAST(dv_tenant_id AS VARCHAR(MAX)))), ''''), ''^^''), ''||'',
        ISNULL(NULLIF(UPPER(TRIM(CAST(dv_collisioncode AS VARCHAR(MAX)))), ''''), ''^^''), ''||'',
        ISNULL(NULLIF(UPPER(TRIM(CAST(user_code AS VARCHAR(MAX)))), ''''), ''^^'')
    ), ''^^||^^||^^'')), 2) AS dv_hash_key_h_user,

    CONVERT(CHAR(32), HASHBYTES(''MD5'', CONCAT(
        ISNULL(NULLIF(UPPER(TRIM(CAST([Active] AS VARCHAR(MAX)))), ''''), ''^^''), ''||'',
        ISNULL(NULLIF(UPPER(TRIM(CAST([BeginWorkDate] AS VARCHAR(MAX)))), ''''), ''^^''), ''||'',
        ISNULL(NULLIF(UPPER(TRIM(CAST([EmployeeCode] AS VARCHAR(MAX)))), ''''), ''^^''), ''||'',
        ISNULL(NULLIF(UPPER(TRIM(CAST([FirstName] AS VARCHAR(MAX)))), ''''), ''^^''), ''||'',
        ISNULL(NULLIF(UPPER(TRIM(CAST([Gender] AS VARCHAR(MAX)))), ''''), ''^^''), ''||'',
        ISNULL(NULLIF(UPPER(TRIM(CAST([ID] AS VARCHAR(MAX)))), ''''), ''^^''), ''||'',
        ISNULL(NULLIF(UPPER(TRIM(CAST([LastName] AS VARCHAR(MAX)))), ''''), ''^^''), ''||'',
        ISNULL(NULLIF(UPPER(TRIM(CAST([TitleID] AS VARCHAR(MAX)))), ''''), ''^^'')
    )), 2) AS dv_hashdiff_s_h_user

    FROM derived_columns
),

columns_to_select AS (

    SELECT

    ID,
    Email,
    Password,
    FirstName,
    LastName,
    EmployeeCode,
    Image,
    Thumb,
    DOB,
    Gender,
    Address,
    Phone,
    Active,
    Display,
    CreatedDate,
    CreatedByName,
    CreatedByID,
    TitleID,
    UserName,
    ContractDate,
    BeginWorkDate,
    LoyaltyYear,
    ModifiedDate,
    ModifiedByID,
    ModifiedByName,
    IsIntership,
    TitleText,
    WeightUser,
    EmployeeTypeID,
    About,
    Facebook,
    Twitter,
    GooglePlus,
    History,
    IsShowContact,
    KPIEmployeeTypeID,
    QuitDate,
    IsExternal,
    UserType,
    TokenKey,
    EndContractDate,
    HRCandidateID,
    AltEmail,
    AltPassword,
    AltUserName,
    SocialInsuranceNumber,
    Certificate,
    IdentityCardNumber,
    IdentityCardDate,
    IdentityCardPlace,
    CompanyID,
    LocationID,
    WorkTime,
    LevelText,
    Major,
    School,
    CurrentAdress,
    GroupTypeID,
    NextTokenKey,
    TokenExpiredDate,
    StatusSync,
    TimeSync,
    CountSync,
    CurrentURL,
    RoleID,
    GroupID,
    IsEmpNoMax,
    DV_RECORD_SOURCE,
    DV_APPLIED_DATE,
    dv_recordsource,
    dv_load_timestamp,
    user_code,
    dv_tenant_id,
    dv_collisioncode,
    dv_hash_key_h_user,
    dv_hashdiff_s_h_user

    FROM hashed_columns
)

SELECT * FROM columns_to_select;');

