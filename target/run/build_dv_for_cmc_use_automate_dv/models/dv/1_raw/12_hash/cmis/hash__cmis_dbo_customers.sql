
    

    EXEC('create view "dbo"."hash__cmis_dbo_customers__dbt_tmp" as 
-- Generated by AutomateDV (formerly known as dbtvault)

    

WITH source_data AS (

    SELECT

    ID,
    Code,
    TaxCode,
    Name,
    Address,
    Phone,
    Fax,
    Email,
    Website,
    Description,
    PublishType,
    Activate,
    IsDeleted,
    CreatedDate,
    CreatedByID,
    CreatedByName,
    ModifiedDate,
    ModifiedByID,
    ModifiedByName,
    BaseSource,
    LastUpdateBase,
    CustomerTypeID,
    HasCredit,
    CreditLimited,
    IndustryTypeID,
    DepartmentID,
    EnvironmentTypeID,
    ReasonsRefusal,
    Image,
    Thumb,
    AccountHolder,
    AccountNmuber,
    Bank,
    IsVip,
    IsPeersSI,
    IsCustomer,
    IsProvided,
    UserTAMID,
    IsHidden,
    PunishRatio,
    NameEng,
    AddressEng,
    ParentID,
    ParentCode,
    ADN,
    LastChildADN,
    AmIDs,
    Ams,
    SubIDs,
    Subs,
    ChildCompanies,
    CustomerTypeName,
    AccountGroupID,
    PartnerID,
    CountryID,
    CurrentURL,
    TimeSync,
    StatusSync,
    CountSync,
    DateGetData,
    CompanyCode,
    AccountGroupsCode,
    EnvironmentTypesCode,
    IndustryTypesCode,
    PartnerCode,
    CountryCode,
    DV_RECORD_SOURCE,
    DV_APPLIED_DATE

    FROM "DWH"."dbo"."stg__cmis_dbo_customers"
),

derived_columns AS (

    SELECT

    ID,
    Code,
    TaxCode,
    Name,
    Address,
    Phone,
    Fax,
    Email,
    Website,
    Description,
    PublishType,
    Activate,
    IsDeleted,
    CreatedDate,
    CreatedByID,
    CreatedByName,
    ModifiedDate,
    ModifiedByID,
    ModifiedByName,
    BaseSource,
    LastUpdateBase,
    CustomerTypeID,
    HasCredit,
    CreditLimited,
    IndustryTypeID,
    DepartmentID,
    EnvironmentTypeID,
    ReasonsRefusal,
    Image,
    Thumb,
    AccountHolder,
    AccountNmuber,
    Bank,
    IsVip,
    IsPeersSI,
    IsCustomer,
    IsProvided,
    UserTAMID,
    IsHidden,
    PunishRatio,
    NameEng,
    AddressEng,
    ParentID,
    ParentCode,
    ADN,
    LastChildADN,
    AmIDs,
    Ams,
    SubIDs,
    Subs,
    ChildCompanies,
    CustomerTypeName,
    AccountGroupID,
    PartnerID,
    CountryID,
    CurrentURL,
    TimeSync,
    StatusSync,
    CountSync,
    DateGetData,
    CompanyCode,
    AccountGroupsCode,
    EnvironmentTypesCode,
    IndustryTypesCode,
    PartnerCode,
    CountryCode,
    DV_RECORD_SOURCE,
    DV_APPLIED_DATE,
    DV_RECORD_SOURCE AS dv_recordsource,
    cast( DV_APPLIED_DATE as DATETIME2(6)) AS dv_load_timestamp,
    cast(ID as VARCHAR(8000)) AS customer_code,
    cast(Code as VARCHAR(8000)) AS customer_code2,
    ''default'' AS dv_tenant_id,
    ''default'' AS dv_collisioncode

    FROM source_data
),

hashed_columns AS (

    SELECT

    ID,
    Code,
    TaxCode,
    Name,
    Address,
    Phone,
    Fax,
    Email,
    Website,
    Description,
    PublishType,
    Activate,
    IsDeleted,
    CreatedDate,
    CreatedByID,
    CreatedByName,
    ModifiedDate,
    ModifiedByID,
    ModifiedByName,
    BaseSource,
    LastUpdateBase,
    CustomerTypeID,
    HasCredit,
    CreditLimited,
    IndustryTypeID,
    DepartmentID,
    EnvironmentTypeID,
    ReasonsRefusal,
    Image,
    Thumb,
    AccountHolder,
    AccountNmuber,
    Bank,
    IsVip,
    IsPeersSI,
    IsCustomer,
    IsProvided,
    UserTAMID,
    IsHidden,
    PunishRatio,
    NameEng,
    AddressEng,
    ParentID,
    ParentCode,
    ADN,
    LastChildADN,
    AmIDs,
    Ams,
    SubIDs,
    Subs,
    ChildCompanies,
    CustomerTypeName,
    AccountGroupID,
    PartnerID,
    CountryID,
    CurrentURL,
    TimeSync,
    StatusSync,
    CountSync,
    DateGetData,
    CompanyCode,
    AccountGroupsCode,
    EnvironmentTypesCode,
    IndustryTypesCode,
    PartnerCode,
    CountryCode,
    DV_RECORD_SOURCE,
    DV_APPLIED_DATE,
    dv_recordsource,
    dv_load_timestamp,
    customer_code,
    customer_code2,
    dv_tenant_id,
    dv_collisioncode,

    CONVERT(CHAR(32), HASHBYTES(''MD5'', NULLIF(CONCAT(
        ISNULL(NULLIF(UPPER(TRIM(CAST(dv_tenant_id AS VARCHAR(MAX)))), ''''), ''^^''), ''||'',
        ISNULL(NULLIF(UPPER(TRIM(CAST(dv_collisioncode AS VARCHAR(MAX)))), ''''), ''^^''), ''||'',
        ISNULL(NULLIF(UPPER(TRIM(CAST(customer_code AS VARCHAR(MAX)))), ''''), ''^^'')
    ), ''^^||^^||^^'')), 2) AS dv_hash_key_h_customer,

    CONVERT(CHAR(32), HASHBYTES(''MD5'', NULLIF(CONCAT(
        ISNULL(NULLIF(UPPER(TRIM(CAST(dv_tenant_id AS VARCHAR(MAX)))), ''''), ''^^''), ''||'',
        ISNULL(NULLIF(UPPER(TRIM(CAST(dv_collisioncode AS VARCHAR(MAX)))), ''''), ''^^''), ''||'',
        ISNULL(NULLIF(UPPER(TRIM(CAST(customer_code2 AS VARCHAR(MAX)))), ''''), ''^^'')
    ), ''^^||^^||^^'')), 2) AS dv_hash_key_h_customer2,

    CONVERT(CHAR(32), HASHBYTES(''MD5'', CONCAT(
        ISNULL(NULLIF(UPPER(TRIM(CAST(Address AS VARCHAR(MAX)))), ''''), ''^^''), ''||'',
        ISNULL(NULLIF(UPPER(TRIM(CAST(CustomerTypeID AS VARCHAR(MAX)))), ''''), ''^^''), ''||'',
        ISNULL(NULLIF(UPPER(TRIM(CAST(Email AS VARCHAR(MAX)))), ''''), ''^^''), ''||'',
        ISNULL(NULLIF(UPPER(TRIM(CAST(EnvironmentTypeID AS VARCHAR(MAX)))), ''''), ''^^''), ''||'',
        ISNULL(NULLIF(UPPER(TRIM(CAST(IndustryTypeID AS VARCHAR(MAX)))), ''''), ''^^''), ''||'',
        ISNULL(NULLIF(UPPER(TRIM(CAST(Name AS VARCHAR(MAX)))), ''''), ''^^''), ''||'',
        ISNULL(NULLIF(UPPER(TRIM(CAST(ParentID AS VARCHAR(MAX)))), ''''), ''^^''), ''||'',
        ISNULL(NULLIF(UPPER(TRIM(CAST(Phone AS VARCHAR(MAX)))), ''''), ''^^'')
    )), 2) AS dv_hashdiff_s_h_customer,

    CONVERT(CHAR(32), HASHBYTES(''MD5'', ISNULL(NULLIF(UPPER(TRIM(CAST(DV_APPLIED_DATE AS VARCHAR(MAX)))), ''''), ''^^'')), 2) AS dv_hashdiff_s_h_customer_rt

    FROM derived_columns
),

columns_to_select AS (

    SELECT

    ID,
    Code,
    TaxCode,
    Name,
    Address,
    Phone,
    Fax,
    Email,
    Website,
    Description,
    PublishType,
    Activate,
    IsDeleted,
    CreatedDate,
    CreatedByID,
    CreatedByName,
    ModifiedDate,
    ModifiedByID,
    ModifiedByName,
    BaseSource,
    LastUpdateBase,
    CustomerTypeID,
    HasCredit,
    CreditLimited,
    IndustryTypeID,
    DepartmentID,
    EnvironmentTypeID,
    ReasonsRefusal,
    Image,
    Thumb,
    AccountHolder,
    AccountNmuber,
    Bank,
    IsVip,
    IsPeersSI,
    IsCustomer,
    IsProvided,
    UserTAMID,
    IsHidden,
    PunishRatio,
    NameEng,
    AddressEng,
    ParentID,
    ParentCode,
    ADN,
    LastChildADN,
    AmIDs,
    Ams,
    SubIDs,
    Subs,
    ChildCompanies,
    CustomerTypeName,
    AccountGroupID,
    PartnerID,
    CountryID,
    CurrentURL,
    TimeSync,
    StatusSync,
    CountSync,
    DateGetData,
    CompanyCode,
    AccountGroupsCode,
    EnvironmentTypesCode,
    IndustryTypesCode,
    PartnerCode,
    CountryCode,
    DV_RECORD_SOURCE,
    DV_APPLIED_DATE,
    dv_recordsource,
    dv_load_timestamp,
    customer_code,
    customer_code2,
    dv_tenant_id,
    dv_collisioncode,
    dv_hash_key_h_customer,
    dv_hash_key_h_customer2,
    dv_hashdiff_s_h_customer,
    dv_hashdiff_s_h_customer_rt

    FROM hashed_columns
)

SELECT * FROM columns_to_select;');

