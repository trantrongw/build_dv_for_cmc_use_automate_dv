
  
    
   
   
    

    EXEC('create view "dbo"."hash__cmis_dbo_contracts__dbt_tmp_temp_view" as 
-- Generated by AutomateDV (formerly known as dbtvault)

    

WITH source_data AS (

    SELECT

    ID,
    Code,
    Tag,
    OpportunityID,
    SignedDate,
    CorporationID,
    ContractTypeID,
    Content,
    IsMaster,
    TotalBeforeVAT,
    TotalVAT,
    TotalAfterVAT,
    WarrantyLocationType,
    WarrantyApplicationType,
    WarrantyType,
    WarrantyProcessingType,
    WarrantyReturnType,
    WarrantyOtherLocationType,
    WarrantyCommitmentType,
    FileAttachments,
    PublishType,
    CreatedDate,
    CreatedByID,
    CreatedByName,
    ModifiedDate,
    ModifiedByID,
    ModifiedByName,
    IsLockContract,
    NumberOfSBA,
    SBA,
    ProductName,
    BeginDateWarranty,
    EndDateWarranty,
    ParentID,
    BaseSource,
    LastUpdateBase,
    Activate,
    RevenueSerial,
    TimeContractSerial,
    UserShareID,
    UserActionID,
    SubUserID,
    GroupID,
    NumberShare,
    NumberAction,
    NumberGroupShare,
    CheckSparePart,
    UserShareActivity,
    UserActionActivity,
    SubUserActivity,
    LockDate,
    ValueHardware,
    ValueLock,
    CustomerID,
    IsUseBHMR,
    ValueBHMR,
    ProjectEndDate,
    LockTypeName,
    AdditionalTerm,
    LockType,
    Explanation,
    RequestCommerce,
    ValueVATLock,
    WarrantyDescription,
    ManagedServicesFrom,
    ManagedServicesTo,
    UpgradeSoftwareFrom,
    UpgradeSoftwareTo,
    SupportSoftwareFrom,
    SupportSoftwareTo,
    RegularMaintenanceFrom,
    RegularMaintenanceTo,
    IsPaymentGuarantee,
    SubSupportUserID,
    ManagedServices,
    UpgradeSoftware,
    SupportSoftware,
    RegularMaintenance,
    CustomerTag,
    Url,
    IsSync,
    DateSync,
    DV_RECORD_SOURCE,
    DV_APPLIED_DATE

    FROM "DWH"."dbo"."stg__cmis_dbo_contracts"
),

derived_columns AS (

    SELECT

    ID,
    Code,
    Tag,
    OpportunityID,
    SignedDate,
    CorporationID,
    ContractTypeID,
    Content,
    IsMaster,
    TotalBeforeVAT,
    TotalVAT,
    TotalAfterVAT,
    WarrantyLocationType,
    WarrantyApplicationType,
    WarrantyType,
    WarrantyProcessingType,
    WarrantyReturnType,
    WarrantyOtherLocationType,
    WarrantyCommitmentType,
    FileAttachments,
    PublishType,
    CreatedDate,
    CreatedByID,
    CreatedByName,
    ModifiedDate,
    ModifiedByID,
    ModifiedByName,
    IsLockContract,
    NumberOfSBA,
    SBA,
    ProductName,
    BeginDateWarranty,
    EndDateWarranty,
    ParentID,
    BaseSource,
    LastUpdateBase,
    Activate,
    RevenueSerial,
    TimeContractSerial,
    UserShareID,
    UserActionID,
    SubUserID,
    GroupID,
    NumberShare,
    NumberAction,
    NumberGroupShare,
    CheckSparePart,
    UserShareActivity,
    UserActionActivity,
    SubUserActivity,
    LockDate,
    ValueHardware,
    ValueLock,
    CustomerID,
    IsUseBHMR,
    ValueBHMR,
    ProjectEndDate,
    LockTypeName,
    AdditionalTerm,
    LockType,
    Explanation,
    RequestCommerce,
    ValueVATLock,
    WarrantyDescription,
    ManagedServicesFrom,
    ManagedServicesTo,
    UpgradeSoftwareFrom,
    UpgradeSoftwareTo,
    SupportSoftwareFrom,
    SupportSoftwareTo,
    RegularMaintenanceFrom,
    RegularMaintenanceTo,
    IsPaymentGuarantee,
    SubSupportUserID,
    ManagedServices,
    UpgradeSoftware,
    SupportSoftware,
    RegularMaintenance,
    CustomerTag,
    Url,
    IsSync,
    DateSync,
    DV_RECORD_SOURCE,
    DV_APPLIED_DATE,
    DV_RECORD_SOURCE AS dv_recordsource,
    cast( DV_APPLIED_DATE as DATETIME2(6)) AS dv_load_timestamp,
    cast([OpportunityID] as VARCHAR(8000)) AS opportunity_code,
    cast([ID] as VARCHAR(8000)) AS contract_code,
    ''default'' AS dv_tenant_id,
    ''default'' AS dv_collisioncode

    FROM source_data
),

hashed_columns AS (

    SELECT

    ID,
    Code,
    Tag,
    OpportunityID,
    SignedDate,
    CorporationID,
    ContractTypeID,
    Content,
    IsMaster,
    TotalBeforeVAT,
    TotalVAT,
    TotalAfterVAT,
    WarrantyLocationType,
    WarrantyApplicationType,
    WarrantyType,
    WarrantyProcessingType,
    WarrantyReturnType,
    WarrantyOtherLocationType,
    WarrantyCommitmentType,
    FileAttachments,
    PublishType,
    CreatedDate,
    CreatedByID,
    CreatedByName,
    ModifiedDate,
    ModifiedByID,
    ModifiedByName,
    IsLockContract,
    NumberOfSBA,
    SBA,
    ProductName,
    BeginDateWarranty,
    EndDateWarranty,
    ParentID,
    BaseSource,
    LastUpdateBase,
    Activate,
    RevenueSerial,
    TimeContractSerial,
    UserShareID,
    UserActionID,
    SubUserID,
    GroupID,
    NumberShare,
    NumberAction,
    NumberGroupShare,
    CheckSparePart,
    UserShareActivity,
    UserActionActivity,
    SubUserActivity,
    LockDate,
    ValueHardware,
    ValueLock,
    CustomerID,
    IsUseBHMR,
    ValueBHMR,
    ProjectEndDate,
    LockTypeName,
    AdditionalTerm,
    LockType,
    Explanation,
    RequestCommerce,
    ValueVATLock,
    WarrantyDescription,
    ManagedServicesFrom,
    ManagedServicesTo,
    UpgradeSoftwareFrom,
    UpgradeSoftwareTo,
    SupportSoftwareFrom,
    SupportSoftwareTo,
    RegularMaintenanceFrom,
    RegularMaintenanceTo,
    IsPaymentGuarantee,
    SubSupportUserID,
    ManagedServices,
    UpgradeSoftware,
    SupportSoftware,
    RegularMaintenance,
    CustomerTag,
    Url,
    IsSync,
    DateSync,
    DV_RECORD_SOURCE,
    DV_APPLIED_DATE,
    dv_recordsource,
    dv_load_timestamp,
    opportunity_code,
    contract_code,
    dv_tenant_id,
    dv_collisioncode,

    CONVERT(CHAR(32), HASHBYTES(''MD5'', NULLIF(CONCAT(
        ISNULL(NULLIF(UPPER(TRIM(CAST(dv_tenant_id AS VARCHAR(MAX)))), ''''), ''^^''), ''||'',
        ISNULL(NULLIF(UPPER(TRIM(CAST(dv_collisioncode AS VARCHAR(MAX)))), ''''), ''^^''), ''||'',
        ISNULL(NULLIF(UPPER(TRIM(CAST(contract_code AS VARCHAR(MAX)))), ''''), ''^^'')
    ), ''^^||^^||^^'')), 2) AS dv_hash_key_h_contract,

    CONVERT(CHAR(32), HASHBYTES(''MD5'', NULLIF(CONCAT(
        ISNULL(NULLIF(UPPER(TRIM(CAST(dv_tenant_id AS VARCHAR(MAX)))), ''''), ''^^''), ''||'',
        ISNULL(NULLIF(UPPER(TRIM(CAST(dv_collisioncode AS VARCHAR(MAX)))), ''''), ''^^''), ''||'',
        ISNULL(NULLIF(UPPER(TRIM(CAST(opportunity_code AS VARCHAR(MAX)))), ''''), ''^^'')
    ), ''^^||^^||^^'')), 2) AS dv_hash_key_h_opportunity,

    CONVERT(CHAR(32), HASHBYTES(''MD5'', NULLIF(CONCAT(
        ISNULL(NULLIF(UPPER(TRIM(CAST(dv_tenant_id AS VARCHAR(MAX)))), ''''), ''^^''), ''||'',
        ISNULL(NULLIF(UPPER(TRIM(CAST(dv_collisioncode AS VARCHAR(MAX)))), ''''), ''^^''), ''||'',
        ISNULL(NULLIF(UPPER(TRIM(CAST(opportunity_code AS VARCHAR(MAX)))), ''''), ''^^''), ''||'',
        ISNULL(NULLIF(UPPER(TRIM(CAST(contract_code AS VARCHAR(MAX)))), ''''), ''^^'')
    ), ''^^||^^||^^||^^'')), 2) AS dv_hash_key_l_opportunity_contract,

    CONVERT(CHAR(32), HASHBYTES(''MD5'', ISNULL(NULLIF(UPPER(TRIM(CAST([Activate] AS VARCHAR(MAX)))), ''''), ''^^'')), 2) AS dv_hashdiff_s_h_contract

    FROM derived_columns
),

columns_to_select AS (

    SELECT

    ID,
    Code,
    Tag,
    OpportunityID,
    SignedDate,
    CorporationID,
    ContractTypeID,
    Content,
    IsMaster,
    TotalBeforeVAT,
    TotalVAT,
    TotalAfterVAT,
    WarrantyLocationType,
    WarrantyApplicationType,
    WarrantyType,
    WarrantyProcessingType,
    WarrantyReturnType,
    WarrantyOtherLocationType,
    WarrantyCommitmentType,
    FileAttachments,
    PublishType,
    CreatedDate,
    CreatedByID,
    CreatedByName,
    ModifiedDate,
    ModifiedByID,
    ModifiedByName,
    IsLockContract,
    NumberOfSBA,
    SBA,
    ProductName,
    BeginDateWarranty,
    EndDateWarranty,
    ParentID,
    BaseSource,
    LastUpdateBase,
    Activate,
    RevenueSerial,
    TimeContractSerial,
    UserShareID,
    UserActionID,
    SubUserID,
    GroupID,
    NumberShare,
    NumberAction,
    NumberGroupShare,
    CheckSparePart,
    UserShareActivity,
    UserActionActivity,
    SubUserActivity,
    LockDate,
    ValueHardware,
    ValueLock,
    CustomerID,
    IsUseBHMR,
    ValueBHMR,
    ProjectEndDate,
    LockTypeName,
    AdditionalTerm,
    LockType,
    Explanation,
    RequestCommerce,
    ValueVATLock,
    WarrantyDescription,
    ManagedServicesFrom,
    ManagedServicesTo,
    UpgradeSoftwareFrom,
    UpgradeSoftwareTo,
    SupportSoftwareFrom,
    SupportSoftwareTo,
    RegularMaintenanceFrom,
    RegularMaintenanceTo,
    IsPaymentGuarantee,
    SubSupportUserID,
    ManagedServices,
    UpgradeSoftware,
    SupportSoftware,
    RegularMaintenance,
    CustomerTag,
    Url,
    IsSync,
    DateSync,
    DV_RECORD_SOURCE,
    DV_APPLIED_DATE,
    dv_recordsource,
    dv_load_timestamp,
    opportunity_code,
    contract_code,
    dv_tenant_id,
    dv_collisioncode,
    dv_hash_key_h_contract,
    dv_hash_key_h_opportunity,
    dv_hash_key_l_opportunity_contract,
    dv_hashdiff_s_h_contract

    FROM hashed_columns
)

SELECT * FROM columns_to_select;');


   EXEC('CREATE TABLE "dbo"."hash__cmis_dbo_contracts__dbt_tmp" AS (SELECT * FROM "dbo"."hash__cmis_dbo_contracts__dbt_tmp_temp_view");');
   
    
    

    
    

    
    

    EXEC('DROP view IF EXISTS "dbo"."hash__cmis_dbo_contracts__dbt_tmp_temp_view";');




  